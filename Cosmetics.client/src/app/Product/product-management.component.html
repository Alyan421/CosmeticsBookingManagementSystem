<div class="product-container">
  <div class="product-header">
    <h1>Inventory Management</h1>
    <p>Manage product levels for all brand-category combinations</p>
  </div>

  <!-- Product List Section -->
  <div class="product-list-container card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2>Current Inventory</h2>
      <div class="product-actions">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="searchTerm" (keyup.enter)="onSearch()">
          <div class="input-group-append">
            <button class="btn btn-outline-secondary" type="button" (click)="onSearch()">
              <i class="fas fa-search"></i>
            </button>
          </div>
        </div>
        <button class="btn btn-success ml-2" (click)="exportToCSV()">
          <i class="fas fa-file-export"></i> Export CSV
        </button>
        <button class="btn btn-info ml-2" (click)="loadData()">
          <i class="fas fa-sync"></i> Refresh
        </button>
      </div>
    </div>
    <div class="card-body">
      <div *ngIf="isLoading" class="text-center p-5">
        <div class="spinner-border text-primary" role="status">
          <span class="sr-only">Loading...</span>
        </div>
        <p class="mt-2">Loading inventory data...</p>
      </div>

      <!-- Add this to your product-management.component.html -->
      <div *ngIf="isEditing" class="edit-modal">
        <div class="modal-content">
          <div class="modal-header">
            <h2>Edit Product</h2>
            <button type="button" class="close-btn" (click)="resetForm()">&times;</button>
          </div>
          <div class="modal-body">
            <form [formGroup]="productForm" (ngSubmit)="submitForm()" id="productForm">
              <div class="form-group">
                <label>Brand</label>
                <input type="text" class="form-control" [value]="getBrandName(productForm.get('brandId')?.value)" disabled>
              </div>
              <div class="form-group">
                <label>Category</label>
                <input type="text" class="form-control" [value]="getCategoryName(productForm.get('categoryId')?.value)" disabled>
              </div>
              <div class="form-group">
                <label for="availableProduct">Available Product</label>
                <input type="number" id="availableProduct" formControlName="availableProduct" class="form-control" min="0">
              </div>
              <div class="form-actions">
                <button type="submit" class="btn btn-primary" [disabled]="productForm.invalid || isSubmitting">
                  <i class="fas fa-save"></i> Update
                </button>
                <button type="button" class="btn btn-secondary" (click)="resetForm()">
                  <i class="fas fa-times"></i> Cancel
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>

      <div *ngIf="!isLoading && filteredProducts.length === 0" class="no-data">
        <i class="fas fa-box-open fa-3x"></i>
        <p>No product items found.</p>
        <p *ngIf="searchTerm">Try changing your search criteria.</p>
      </div>

      <div *ngIf="!isLoading && filteredProducts.length > 0" class="product-table-container">
        <table class="table table-striped table-hover responsive-table">
          <thead class="thead-dark">
            <tr>
              <th>Brand</th>
              <th>Category</th>
              <th class="text-center">Available Product</th>
              <th class="text-center">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let product of filteredProducts">
              <td data-label="Brand">{{ product.brandName }}</td>
              <td data-label="Category">
                <span class="category-swatch" [style.background-category]="product.categoryName"></span>
                {{ product.categoryName }}
              </td>
              <td class="text-center" data-label="Available Product">
                <span [class.text-danger]="product.availableProduct === 0" [class.text-success]="product.availableProduct > 10">
                  {{ product.availableProduct }}
                </span>
              </td>
              <td class="text-center action-column" data-label="Actions">
                <button class="btn btn-sm btn-primary mr-1 responsive-btn" (click)="editProduct(product)" title="Edit">
                  <i class="fas fa-edit"></i><span class="action-text"> Edit</span>
                </button>
                <button class="btn btn-sm btn-danger responsive-btn" (click)="deleteProduct(product)" title="Delete">
                  <i class="fas fa-trash"></i><span class="action-text"> Delete</span>
                </button>
              </td>
            </tr>
          </tbody>
        </table>

        <!-- Pagination -->
        <div class="d-flex justify-content-between align-items-center pagination-container">
          <div class="items-count">
            Showing {{ (currentPage - 1) * itemsPerPage + 1 }} to
            {{ getMinValue(currentPage * itemsPerPage, totalItems) }} of {{ totalItems }} items
          </div>
          <nav aria-label="Product pagination">
            <ul class="pagination">
              <li class="page-item" [class.disabled]="currentPage === 1">
                <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage - 1)">
                  <i class="fas fa-chevron-left"></i>
                </a>
              </li>
              <li class="page-item" *ngFor="let page of getPagesArray(); let i = index"
                  [class.active]="currentPage === i + 1">
                <a class="page-link" href="javascript:void(0)" (click)="onPageChange(i + 1)">{{ i + 1 }}</a>
              </li>
              <li class="page-item" [class.disabled]="currentPage === getTotalPages()">
                <a class="page-link" href="javascript:void(0)" (click)="onPageChange(currentPage + 1)">
                  <i class="fas fa-chevron-right"></i>
                </a>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </div>
  </div>

  <!-- Add information about where to add product -->
  <div class="info-card card">
    <div class="card-body">
      <div class="info-content">
        <i class="fas fa-info-circle info-icon"></i>
        <div>
          <h3>Need to add new product?</h3>
          <p>New product is now created when uploading images. Please go to the <a routerLink="/upload-image">Upload Image</a> page to add new product and upload an image simultaneously.</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Product Modal -->
  <div class="modal-overlay" *ngIf="isEditing">
    <div class="modal-content">
      <div class="modal-header">
        <h2>Update Product</h2>
        <button class="close-btn" (click)="resetForm()">Ã—</button>
      </div>
      <div class="modal-body">
        <form [formGroup]="productForm" (ngSubmit)="submitForm()" id="productForm">
          <div class="form-group">
            <label>Brand</label>
            <input type="text" class="form-control" [value]="getBrandName(productForm.get('brandId')?.value)" disabled>
          </div>
          <div class="form-group">
            <label>Category</label>
            <input type="text" class="form-control" [value]="getCategoryName(productForm.get('categoryId')?.value)" disabled>
          </div>
          <div class="form-group">
            <label for="availableProduct">Available Product</label>
            <input type="number" id="availableProduct" formControlName="availableProduct" class="form-control" min="0">
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary" [disabled]="productForm.invalid || isSubmitting">
              <i class="fas fa-save"></i> Update Product
            </button>
            <button type="button" class="btn btn-secondary" (click)="resetForm()">
              <i class="fas fa-times"></i> Cancel
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
